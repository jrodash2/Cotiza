{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Cotización {{ cotizacion.correlativo }}</title>
  <link rel="stylesheet" href="{% static 'cotizaciones_app/css/cotizacion_print.css' %}">
</head>
<body>
  <div class="cotizacion-page" id="cotizacion-print" data-correlativo="{{ cotizacion.correlativo }}">
    <header class="cotizacion-header">
      <div class="brand">
        {% if institucion and institucion.logo %}
          <img src="{{ institucion.logo.url }}" alt="Logo" class="brand-logo">
        {% endif %}
        <div>
          <h1>Tecnologías de Guatemala</h1>
          <p>Centro de Soporte El Progreso</p>
        </div>
      </div>
      <div class="header-meta">
        <div>
          <span class="label">WhatsApp</span>
          <span class="value">+502 4917-3791</span>
        </div>
        <div>
          <span class="label">Cotización</span>
          <span class="value">{{ cotizacion.correlativo }}</span>
        </div>
        <div>
          <span class="label">Fecha</span>
          <span class="value">{{ cotizacion.fecha_emision }}</span>
        </div>
      </div>
    </header>

    <section class="cotizacion-info">
      <div>
        <h2>Cliente</h2>
        <p><strong>{{ cotizacion.cliente.nombre }}</strong></p>
        <p>{{ cotizacion.cliente.direccion }}</p>
        <p>Tel: {{ cotizacion.cliente.telefono }}</p>
        <p>Email: {{ cotizacion.cliente.email }}</p>
        <p>NIT: {{ cotizacion.cliente.nit }}</p>
      </div>
      <div class="cotizacion-title">
        <h2>COTIZACIÓN</h2>
        {% if cotizacion.titulo %}
          <h3>{{ cotizacion.titulo }}</h3>
        {% endif %}
        <p class="garantia">{{ cotizacion.garantia_texto }}</p>
      </div>
    </section>

    <table class="cotizacion-table">
      <thead>
        <tr>
          <th>Descripción</th>
          <th>Cantidad</th>
          <th>Precio</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>
              <strong>{{ item.producto_servicio.nombre }}</strong><br>
              {{ item.descripcion_editable|default:item.producto_servicio.descripcion }}
            </td>
            <td class="text-center">{{ item.cantidad }}</td>
            <td class="text-end">Q {{ item.precio_venta_unitario|floatformat:2 }}</td>
            <td class="text-end">Q {{ item.total_linea_venta|floatformat:2 }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <section class="totales">
      <div class="totales-box">
        <span>Total</span>
        <strong>Q {{ cotizacion.subtotal_venta|floatformat:2 }}</strong>
      </div>
      <div class="totales-info">
        <p>Validez: {{ cotizacion.validez_dias }} días</p>
        {% if cotizacion.observaciones %}
          <p>Nota: {{ cotizacion.observaciones }}</p>
        {% else %}
          <p>Nota: Adicional Q75.00 por cada cámara si desea audio.</p>
        {% endif %}
      </div>
    </section>

    {% if show_costs %}
      <section class="costos-internos">
        <h4>Costos internos</h4>
        <div class="costos-grid">
          <div>
            <span>Subtotal costo</span>
            <strong>Q {{ cotizacion.subtotal_costo|floatformat:2 }}</strong>
          </div>
          <div>
            <span>Ganancia total</span>
            <strong>Q {{ cotizacion.ganancia_total|floatformat:2 }}</strong>
          </div>
        </div>
      </section>
    {% endif %}

    <footer class="cotizacion-footer">
      <div>
        <p><strong>Cuenta Banrural:</strong> 0000000000000</p>
        <p><strong>Web:</strong> tecnologiadeguatemala.com</p>
      </div>
      <div class="qr-box">
        <p>QR</p>
        <!-- TODO: Generar y mostrar QR cuando exista URL pública o datos configurados. -->
      </div>
    </footer>
  </div>

  {% if download_jpg %}
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="{% static 'cotizaciones_app/js/cotizacion_jpg.js' %}"></script>
  {% endif %}
</body>
</html>
